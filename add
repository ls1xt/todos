#!/usr/bin/env bash
set -e

TITLE="$1"
shift

if [[ -z "$TITLE" ]]; then
  echo "Usage: add <title> [--priority VALUE] [--keywords VALUE] [--project VALUE] [--body VALUE] [--transcription VALUE]" >&2
  exit 1
fi

# Defaults
PRIORITY=""
KEYWORDS=""
PROJECT=""
BODY=""
TRANSCRIPTION=""

# Parse flags
while [[ $# -gt 0 ]]; do
  case "$1" in
    --priority)      PRIORITY="$2";      shift 2 ;;
    --keywords)      KEYWORDS="$2";      shift 2 ;;
    --project)       PROJECT="$2";       shift 2 ;;
    --body)          BODY="$2";          shift 2 ;;
    --transcription) TRANSCRIPTION="$2"; shift 2 ;;
    *) shift ;;
  esac
done

DATE=$(date +%Y-%m-%d)
SLUG=$(echo "$TITLE" | tr '[:upper:]' '[:lower:]' | tr ' ' '-' | tr -cd 'a-z0-9-')
FILENAME="${DATE}-${SLUG}.md"
FILEPATH="open/${FILENAME}"

cat > "$FILEPATH" <<EOF
---
created: ${DATE}
priority: ${PRIORITY}
project: ${PROJECT}
keywords: ${KEYWORDS}
body: ${BODY}
transcription: ${TRANSCRIPTION}
---
EOF

git add "$FILEPATH"
git commit -m "add: ${TITLE}"

echo "created: ${FILEPATH}"
